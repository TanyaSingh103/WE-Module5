<!DOCTYPE html>
<html>
  <body>
    <div id="root"></div>
  </body>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react?dev",
        "react-dom/client": "https://esm.sh/react-dom/client?dev"
      }
    }
  </script>
  <script type="text/babel" data-type="module">
    import React, { useState } from 'react';
    import { createRoot } from 'react-dom/client';

    const mockData = {
      register: {
        id: "dc480fda-a1cc-11ef-8145-f23c94110b38",
        message: "Created"
      },
      create: {
        created: true,
        message: "Created game. Now start posting to /guess"
      },
      guesses: [
        { feedback: "RYRRR", message: "5 guesses left" },
        { feedback: "YRYRR", message: "4 guesses left" },
        { feedback: "YRRYY", message: "3 guesses left" },
        { feedback: "YYGRR", message: "2 guesses left" },
        { feedback: "RGGGG", message: "1 guess left" },
        {
          answer: "jupes",
          feedback: "RGGGG",
          message: "You have exceeded the number of allowed guesses. Post to /create to create a new game"
        }
      ]
    };

    function WordleSquare({ value, status }) {
      const colors = {
        correct: "#6aaa64",
        present: "#c9b458",
        absent: "#787c7e",
        empty: "#fff",
      };
      return (
        <div
          className="wordle-square"
          style={{ backgroundColor: colors[status] || colors.empty }}
        >
          {value}
        </div>
      );
    }

    function WordleBoard({ guesses, currentGuess }) {
      function getGuessStatus(feedback) {
        return feedback.split('').map(letter => {
          if (letter === "G") return "correct";
          else if (letter === "Y") return "present";
          else return "absent";
        });
      }

      return (
        <div className="wordle-board">
          {[...Array(6)].map((_, rowIndex) => {
            const guessObj = guesses[rowIndex];
            const guess = guessObj ? guessObj.guess : "";
            const statuses = guessObj ? getGuessStatus(guessObj.feedback) : Array(5).fill("empty");
            return (
              <div key={rowIndex} className="wordle-row">
                {[...Array(5)].map((_, colIndex) => (
                  <WordleSquare
                    key={colIndex}
                    value={guess[colIndex] || ""}
                    status={statuses[colIndex]}
                  />
                ))}
              </div>
            );
          })}
        </div>
      );
    }

    function WordleGame() {
      const targetWord = "REACT";
      const [guesses, setGuesses] = useState([]);
      const [currentGuess, setCurrentGuess] = useState("");

      function handleKeyPress(event) {
        if (event.key === "Enter" && currentGuess.length === 5) {
          const nextGuess = mockData.guesses[guesses.length];
          if (!nextGuess) {
            alert("Game Over! No more guesses left.");
            return;
          }
          setGuesses([...guesses, { guess: currentGuess, feedback: nextGuess.feedback }]);
          setCurrentGuess("");
          if (nextGuess.feedback === "GGGGG") alert("Congratulations, you guessed the word!");
        } else if (event.key === "Backspace") {
          setCurrentGuess(currentGuess.slice(0, -1));
        } else if (/^[A-Za-z]$/.test(event.key) && currentGuess.length < 5) {
          setCurrentGuess(currentGuess + event.key.toUpperCase());
        }
      }

      return (
        <div className="game" onKeyDown={handleKeyPress} tabIndex="0">
          <h2>Wordle Game</h2>
          <WordleBoard guesses={guesses} currentGuess={currentGuess} />
          <div className="instructions">
            Press letters to type, "Enter" to submit, and "Backspace" to delete.
          </div>
        </div>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<WordleGame />);
  </script>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f0f0f0;
      margin: 0;
    }

    .game {
      outline: none; /* Required for keyboard input */
      text-align: center;
    }

    .wordle-board {
      display: grid;
      grid-template-rows: repeat(6, 50px);
      gap: 5px;
    }

    .wordle-row {
      display: grid;
      grid-template-columns: repeat(5, 50px);
      gap: 5px;
    }

    .wordle-square {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      border: 2px solid #d3d6da;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
    }

    .instructions {
      margin-top: 20px;
      color: #555;
    }
  </style>
</html>
